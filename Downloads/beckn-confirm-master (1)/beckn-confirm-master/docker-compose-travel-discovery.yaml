version: '3.8'

services:
  # Beckn ONIX Adapter - Protocol Engine
  beckn-onix:
    build:
      context: ./beckn-onix
      dockerfile: Dockerfile.adapter-with-plugins
    ports:
      - "5000:5000"
    environment:
      - PORT=5000
    volumes:
      - ./beckn-onix/config:/app/config
    networks:
      - beckn-network
    restart: unless-stopped

  # BAP - Beckn Application Platform (Travel Discovery Aggregator)
  travel-discovery-bap:
    build:
      context: ./bap-travel-discovery
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
      - ONIX_URL=http://beckn-onix:5000
      - BAP_ID=travel-discovery-bap.example.com
      - BAP_URI=http://travel-discovery-bap:8080
    depends_on:
      - beckn-onix
    networks:
      - beckn-network
    restart: unless-stopped

  # BPP - Flights Provider
  travel-discovery-bpp-flights:
    build:
      context: ./travel-discovery-bpp-flights
      dockerfile: Dockerfile
    ports:
      - "7001:7001"
    environment:
      - PORT=7001
      - BPP_ID=flights-bpp.example.com
      - BPP_URI=http://travel-discovery-bpp-flights:7001
      - ONIX_URL=http://beckn-onix:5000
    depends_on:
      - beckn-onix
    networks:
      - beckn-network
    restart: unless-stopped

  # BPP - Hotels Provider
  travel-discovery-bpp-hotels:
    build:
      context: ./travel-discovery-bpp-hotels
      dockerfile: Dockerfile
    ports:
      - "7002:7002"
    environment:
      - PORT=7002
      - BPP_ID=hotels-bpp.example.com
      - BPP_URI=http://travel-discovery-bpp-hotels:7002
      - ONIX_URL=http://beckn-onix:5000
    depends_on:
      - beckn-onix
    networks:
      - beckn-network
    restart: unless-stopped

  # Frontend - React App
  travel-discovery-frontend:
    build:
      context: ./frontend-travel-discovery
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - REACT_APP_BAP_URL=http://localhost:8080
    depends_on:
      - travel-discovery-bap
    networks:
      - beckn-network
    restart: unless-stopped

networks:
  beckn-network:
    driver: bridge

volumes:
  beckn-config:
    driver: local