services:
  # # Beckn ONIX Adapter (Optional - requires plugin binaries)
  # beckn-onix:
  #   build:
  #     context: ./beckn-onix
  #     dockerfile: Dockerfile.adapter
  #   ports:
  #     - "5000:5000"
  #   environment:
  #     - NODE_ENV=development
  #     - PORT=5000
  #     - CONFIG_FILE=/app/config/travel-minimal.yaml
  #   volumes:
  #     - ./beckn-onix/config:/app/config:ro
  #   depends_on:
  #     - redis
  #   networks:
  #     - beckn-network

  # # Redis for ONIX adapter
  # redis:
  #   image: redis:7-alpine
  #   container_name: beckn-redis
  #   ports:
  #     - "6379:6379"
  #   networks:
  #     - beckn-network
  # Mock ONIX adapter (containerized for dev)
  mock-onix:
    image: node:18-alpine
    working_dir: /app
    command: sh -c "npm ci --silent || true; node mock-onix-adapter.js"
    volumes:
      - ./bap-travel-discovery:/app
    networks:
      - beckn-network
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:9090/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # BAP (Beckn Application Platform) - Travel Discovery
  bap-travel-discovery:
    build:
      context: ./bap-travel-discovery
    ports:
      - "8080:8080"
    environment:
      - NODE_ENV=development
      - PORT=8080
      - ONIX_URL=http://mock-onix:9090
      - FLIGHTS_BPP_URL=http://bpp-flights:7001
      - FLIGHTS_INTL_BPP_URL=http://travel-discovery-bpp-international-flights:7005
      - HOTELS_BPP_URL=http://bpp-hotels:7003
    volumes:
      - ./bap-travel-discovery/src:/app/src
      - ./bap-travel-discovery/package.json:/app/package.json
    networks:
      - beckn-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # BPP Flights Provider
  bpp-flights:
    build:
      context: ./travel-discovery-bpp-flights
    ports:
      - "7001:7001"
    environment:
      - NODE_ENV=development
      - PORT=7001
      - BPP_ID=flights-bpp.example.com
      - BPP_URI=http://bpp-flights:7001
    volumes:
      - ./travel-discovery-bpp-flights/src:/app/src
      - ./travel-discovery-bpp-flights/package.json:/app/package.json
    networks:
      - beckn-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7001/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # BPP Hotels Provider (Updated port to 7003)
  bpp-hotels:
    build:
      context: ./travel-discovery-bpp-hotels
    ports:
      - "7003:7003"
    environment:
      - NODE_ENV=development
      - PORT=7003
      - BPP_ID=hotels-bpp.example.com
      - BPP_URI=http://bpp-hotels:7003
    volumes:
      - ./travel-discovery-bpp-hotels/src:/app/src
      - ./travel-discovery-bpp-hotels/package.json:/app/package.json
    networks:
      - beckn-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7003/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # International Flights BPP
  travel-discovery-bpp-international-flights:
    build:
      context: ./travel-discovery-bpp-international-flights
    ports:
      - "7005:7005"
    environment:
      - NODE_ENV=development
      - PORT=7005
      - BPP_ID=flights-intl-bpp.example.com
      - BPP_URI=http://travel-discovery-bpp-international-flights:7005
    volumes:
      - ./travel-discovery-bpp-international-flights/src:/app/src
      - ./travel-discovery-bpp-international-flights/package.json:/app/package.json
    networks:
      - beckn-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7005/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Frontend React Application
  frontend:
    build:
      context: ./frontend-travel-discovery
      dockerfile: Dockerfile
      target: development
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - VITE_BAP_URL=http://localhost:8080
    depends_on:
      - bap-travel-discovery
    volumes:
      - ./frontend-travel-discovery/src:/app/src
      - ./frontend-travel-discovery/public:/app/public
    networks:
      - beckn-network

networks:
  beckn-network:
    driver: bridge
    name: beckn-travel-network

volumes:
  beckn_data: